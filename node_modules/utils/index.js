module.exports = {
	positions_valid : false,
	history_valid : false,
	news_valid : false,
	reports_valid : false,

	cache_positions : [],
	cache_history : [],
	cache_news : [],
	cache_reports : [],

	getPositions : function(funk){
		var readyToReturn = false;

		if( !this.positions_valid ){
			global.db.all("SELECT * from positions ORDER BY order_num" , function(err, _positions){
				if(!err){
					var postions_ajusted = {};
					for (var i = 0; i < _positions.length; i++) {
						if(postions_ajusted[_positions[i].position_name] == undefined)
							postions_ajusted[_positions[i].position_name] = {
								leader:[],
								assistant:[]
							};

						if(_positions[i].assistant == "FALSE")
							postions_ajusted[_positions[i].position_name].leader.push(_positions[i].member_name);
						else{
							postions_ajusted[_positions[i].position_name].assistant.push(_positions[i].member_name);
						}
					};
					this.cache_positions = postions_ajusted;
					this.positions_valid = true;
					funk("Positions", postions_ajusted);
				}else
					funk("Positions", []);

				readyToReturn = true;
			});
		}else{
			funk("Positions", this.cache_positions);
		}
	},

	getNews : function(funk){
		var readyToReturn = false;

		if( !this.news_valid ){
			global.db.all("SELECT * from news ORDER BY order_num" , function(err, _news){
				if(!err){
					this.cache_news = _news;
					this.news_valid = true;
					funk("News", _news);
				}
				else
					funk("News", []);

				readyToReturn = true;
			});
		}else{
			funk("News", this.cache_news);
		}
	},

	getReports : function(funk){
		var readyToReturn = false;

		if( !this.reports_valid ){
			global.db.all("SELECT * from reports ORDER BY order_num" , function(err, _reports){
				if(!err){
					this.cache_reports = _reports;
					this.reports_valid = true;
					funk("Reports", _reports);
				}
				else
					funk("Reports", []);

				readyToReturn = true;
			});
		}else{
			funk("Reports", this.cache_reports);
		}
	},


	getHistory : function(funk){
		var readyToReturn = false;

		if( !this.history_valid ){
			global.db.all("SELECT * from history ORDER BY time" , function(err, _history){
				if(!err){
					this.cache_history = _history;
					this.history_valid = true;
					funk("History", _history);
				}
				else
					funk("History", []);

				readyToReturn = true;
			});
		}else{
			funk("History", this.cache_history);
		}
	},

}